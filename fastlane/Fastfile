default_platform(:android)

platform :android do
  # Lane de CD para Firebase App Distribution
  desc "Construye AAB release de barista-bot-cafe y lo sube a Firebase App Distribution"
  lane :beta do
    sh("flutter build appbundle --release")

    firebase_app_distribution(
      app: ENV["FIREBASE_APP_ID_ANDROID"],
      service_credentials_file: ENV["GOOGLE_APPLICATION_CREDENTIALS"],
      android_artifact_type: "AAB",
      android_artifact_path: "build/app/outputs/bundle/release/app-release.aab",
      release_notes: "Build automatica desde GitHub Actions (barista-bot-cafe)",
      testers: "ricardo.ortiz.gtz.00@gmail.com",
      groups: "qa"
    )
  end

  # Alias para compatibilidad con el nombre anterior
  lane :cd_firebase do
    beta
  end
end
